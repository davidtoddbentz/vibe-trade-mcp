{
  "schemas": [
    {
      "type_id": "exit.trailing_stop",
      "schema_version": 1,
      "etag": "W/\"v2.exit.trailing_stop\"",
      "title": "Trailing Stop",
      "summary": "ATR-based trailing stop that moves with price in favorable direction.",
      "kind": "exit",
      "tags": [
        "spot",
        "exit",
        "trailing",
        "atr",
        "crypto",
        "fx",
        "equity"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./exit.trailing_stop.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "trail_band": {
                "$ref": "common_defs.schema.json#/$defs/BandSpec"
              },
              "trail_trigger": {
                "$ref": "common_defs.schema.json#/$defs/BandEvent"
              }
            },
            "required": [
              "trail_band",
              "trail_trigger"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/ExitActionSpec"
          },
          "risk": {
            "$ref": "common_defs.schema.json#/$defs/PositionRiskSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 100,
        "pit_safe": true
      },
      "slot_hints": {
        "preferred_tfs": [
          "1h",
          "4h"
        ],
        "notes": "Risk block is optional but recommended. Trailing stop uses ATR-based band that moves with price. Engine updates the band position as price moves favorably. See BandSpec docs for bars→days conversion. event.trail_band.mult: values >2 are rare, >2.5 are very rare."
      },
      "examples": [
        {
          "human": "ETH 4h: trailing stop using 2.0 ATR band, exit when price crosses below trailing band",
          "slots": {
            "context": {
              "tf": "4h",
              "symbol": "ETH-USD"
            },
            "event": {
              "trail_band": {
                "band": "keltner",
                "length": 20,
                "mult": 2.0
              },
              "trail_trigger": {
                "kind": "edge_event",
                "edge": "lower",
                "op": "cross_out"
              }
            },
            "action": {
              "mode": "close"
            },
            "risk": {
              "sl_atr": 2.0
            }
          }
        }
      ],
      "updated_at": "2025-12-02T17:58:21Z"
    },
    {
      "type_id": "exit.band_exit",
      "schema_version": 1,
      "etag": "W/\"v2.exit.band_exit\"",
      "title": "Band-Based Exit",
      "summary": "Exit when price touches or crosses a band edge (e.g., opposite band for mean reversion).",
      "kind": "exit",
      "tags": [
        "spot",
        "exit",
        "band",
        "mean-revert",
        "crypto",
        "fx",
        "equity"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./exit.band_exit.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "exit_band": {
                "$ref": "common_defs.schema.json#/$defs/BandSpec"
              },
              "exit_trigger": {
                "$ref": "common_defs.schema.json#/$defs/BandEvent"
              }
            },
            "required": [
              "exit_band",
              "exit_trigger"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/ExitActionSpec"
          },
          "risk": {
            "$ref": "common_defs.schema.json#/$defs/PositionRiskSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 50,
        "pit_safe": true
      },
      "slot_hints": {
        "preferred_tfs": [
          "1h",
          "4h"
        ],
        "notes": "Common use: exit long when price touches upper band (mean reversion), or exit short when price touches lower band. See BandSpec docs for bars→days conversion. event.exit_band.mult: values >2 are rare, >2.5 are very rare, >3 are extreme/dramatic."
      },
      "examples": [
        {
          "human": "ETH 1h: exit long when price touches upper Bollinger Band (mean reversion)",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "ETH-USD"
            },
            "event": {
              "exit_band": {
                "band": "bollinger",
                "length": 20,
                "mult": 2.0
              },
              "exit_trigger": {
                "kind": "edge_event",
                "edge": "upper",
                "op": "touch"
              }
            },
            "action": {
              "mode": "close"
            },
            "risk": {
              "sl_atr": 1.5
            }
          }
        }
      ],
      "updated_at": "2025-12-02T17:58:21Z"
    },
    {
      "type_id": "exit.structure_break",
      "schema_version": 1,
      "etag": "W/\"v2.exit.structure_break\"",
      "title": "Structure Break Exit",
      "summary": "Exit on structure break (breakout in opposite direction indicating trend reversal).",
      "kind": "exit",
      "tags": [
        "spot",
        "exit",
        "breakout",
        "structure",
        "crypto",
        "fx",
        "equity"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./exit.structure_break.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "breakout": {
                "$ref": "common_defs.schema.json#/$defs/BreakoutSpec"
              }
            },
            "required": [
              "breakout"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/ExitActionSpec"
          },
          "risk": {
            "$ref": "common_defs.schema.json#/$defs/PositionRiskSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 100,
        "pit_safe": true
      },
      "slot_hints": {
        "preferred_tfs": [
          "1h",
          "4h"
        ],
        "notes": "Exit when price breaks structure in opposite direction (e.g., exit long on breakdown below recent low)."
      },
      "examples": [
        {
          "human": "BTC 4h: exit long when price breaks below 50-bar low (structure break)",
          "slots": {
            "context": {
              "tf": "4h",
              "symbol": "BTC-USD"
            },
            "event": {
              "breakout": {
                "lookback_bars": 50,
                "buffer_bps": 5,
                "confirm": "close_confirm"
              }
            },
            "action": {
              "mode": "close"
            },
            "risk": {
              "sl_atr": 2.0
            }
          }
        }
      ],
      "updated_at": "2025-12-02T17:58:21Z"
    },
    {
      "type_id": "exit.squeeze_compression",
      "schema_version": 1,
      "etag": "W/\"v1.exit.squeeze_compression\"",
      "title": "Squeeze Compression Exit",
      "summary": "Exit when volatility compresses back into squeeze (opposite of squeeze expansion entry).",
      "kind": "exit",
      "tags": [
        "spot",
        "exit",
        "volatility",
        "squeeze",
        "crypto",
        "fx",
        "equity"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./exit.squeeze_compression.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "squeeze": {
                "$ref": "common_defs.schema.json#/$defs/SqueezeSpec"
              }
            },
            "required": [
              "squeeze"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/ExitActionSpec"
          },
          "risk": {
            "$ref": "common_defs.schema.json#/$defs/PositionRiskSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 100,
        "pit_safe": true
      },
      "slot_hints": {
        "preferred_tfs": [
          "1h",
          "4h"
        ],
        "notes": "Exit when volatility compresses back into squeeze (e.g., BB width pctile drops below threshold). This is the opposite of squeeze expansion entry - exit when the squeeze returns."
      },
      "examples": [
        {
          "human": "ETH 1h: exit long when BB width pctile drops below 10 (squeeze returns)",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "ETH-USD"
            },
            "event": {
              "squeeze": {
                "metric": "bb_width_pctile",
                "pctile_min": 10
              }
            },
            "action": {
              "mode": "close"
            },
            "risk": {
              "sl_atr": 2.0
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    },
    {
      "type_id": "exit.vwap_reversion",
      "schema_version": 1,
      "etag": "W/\"v1.exit.vwap_reversion\"",
      "title": "VWAP Reversion Exit",
      "summary": "Exit when price returns to anchored VWAP (mean reversion target) or moves too far from VWAP.",
      "kind": "exit",
      "tags": [
        "spot",
        "exit",
        "vwap",
        "mean-revert",
        "equity",
        "crypto",
        "fx"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./exit.vwap_reversion.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "anchor": {
                "$ref": "common_defs.schema.json#/$defs/VWAPAnchorSpec"
              },
              "dist_sigma_exit": {
                "type": "number",
                "minimum": 0.1,
                "maximum": 10.0,
                "description": "Exit when price distance from VWAP is less than this sigma (mean reversion target)"
              },
              "dist_sigma_stop": {
                "type": "number",
                "minimum": 0.1,
                "maximum": 10.0,
                "description": "Optional: exit when price moves further than this sigma from VWAP (stop loss)"
              }
            },
            "required": [
              "anchor",
              "dist_sigma_exit"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/ExitActionSpec"
          },
          "risk": {
            "$ref": "common_defs.schema.json#/$defs/PositionRiskSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 100,
        "pit_safe": true
      },
      "slot_hints": {
        "preferred_tfs": [
          "1h",
          "4h"
        ],
        "notes": "Use dist_sigma_exit to exit when price returns to VWAP (mean reversion target). Optionally use dist_sigma_stop to exit if price moves too far from VWAP."
      },
      "examples": [
        {
          "human": "BTC 1h: exit long when price returns within 0.5σ of AVWAP (YTD)",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "BTC-USD"
            },
            "event": {
              "anchor": {
                "anchor": "ytd"
              },
              "dist_sigma_exit": 0.5
            },
            "action": {
              "mode": "close"
            },
            "risk": {
              "sl_atr": 1.5
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    },
    {
      "type_id": "exit.rule_trigger",
      "schema_version": 1,
      "etag": "W/\"v1.exit.rule_trigger\"",
      "title": "Rule-Based Exit",
      "summary": "Generic exit triggered by a ConditionSpec. Use for simple rule-based exits like 'exit if ret_pct > 5%' or 'exit when volatility becomes high'. Supports composable conditions via ConditionSpec (use type='regime' for single conditions).",
      "kind": "exit",
      "tags": [
        "spot",
        "exit",
        "rule",
        "generic",
        "crypto",
        "fx",
        "equity"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./exit.rule_trigger.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "condition": {
                "$ref": "common_defs.schema.json#/$defs/ConditionSpec",
                "description": "Condition that triggers the exit. Use ConditionSpec with type='regime' for single conditions, or compose multiple conditions with allOf/anyOf/not/sequence."
              }
            },
            "required": [
              "condition"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/ExitActionSpec"
          },
          "risk": {
            "$ref": "common_defs.schema.json#/$defs/PositionRiskSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 100,
        "pit_safe": true
      },
      "slot_hints": {
        "preferred_tfs": [
          "15m",
          "1h",
          "4h",
          "1d"
        ],
        "notes": "Use this archetype for simple rule-based exits. The condition field accepts ConditionSpec. For single conditions, use ConditionSpec with type='regime' and a RegimeSpec object. RegimeSpec metrics include: ret_pct, gap_pct, dist_from_vwap_pct, trend_regime, vol_regime, session_phase, etc. ConditionSpec supports logical composition (allOf, anyOf, not, sequence) for complex conditions. For complex pattern-based exits, use pattern-specific archetypes instead. Optional action.execution specifies order type (market/limit/stop) for exit orders. Optional action.sizing specifies how much to exit (fixed USD, fixed units, or percentage of equity/position)."
      },
      "examples": [
        {
          "human": "BTC 1h: exit long if return exceeds 5% (ret_pct > 5%)",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "BTC-USD"
            },
            "event": {
              "condition": {
                "type": "regime",
                "regime": {
                  "metric": "ret_pct",
                  "tf": "1h",
                  "op": ">",
                  "value": 5.0,
                  "lookback_bars": 1
                }
              }
            },
            "action": {
              "mode": "close",
              "confirm": "none"
            }
          }
        },
        {
          "human": "ETH 4h: exit when volatility regime becomes high",
          "slots": {
            "context": {
              "tf": "4h",
              "symbol": "ETH-USD"
            },
            "event": {
              "condition": {
                "type": "regime",
                "regime": {
                  "metric": "vol_regime",
                  "tf": "4h",
                  "op": "==",
                  "value": "high",
                  "lookback_bars": 200
                }
              }
            },
            "action": {
              "mode": "close",
              "confirm": "none"
            }
          }
        },
        {
          "human": "ETH 1h: exit long with limit order 0.5% above current price, exit 50% of position",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "ETH-USD"
            },
            "event": {
              "condition": {
                "metric": "ret_pct",
                "tf": "1h",
                "op": ">",
                "value": 5.0,
                "lookback_bars": 1
              }
            },
            "action": {
              "mode": "reduce",
              "execution": {
                "order_type": "limit",
                "limit_offset_pct": 0.5,
                "time_in_force": "day"
              },
              "sizing": {
                "type": "pct_position",
                "pct": 50.0
              }
            }
          }
        },
        {
          "human": "AAPL 1h: exit if price moves > 2% above YTD VWAP",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "AAPL"
            },
            "event": {
              "condition": {
                "metric": "dist_from_vwap_pct",
                "tf": "1h",
                "op": ">",
                "value": 2.0,
                "vwap_anchor": {
                  "anchor": "ytd"
                }
              }
            },
            "action": {
              "mode": "close",
              "confirm": "close_confirm"
            }
          }
        },
        {
          "human": "BTC 1d: exit if trend regime changes from up to down",
          "slots": {
            "context": {
              "tf": "1d",
              "symbol": "BTC-USD"
            },
            "event": {
              "condition": {
                "metric": "trend_regime",
                "tf": "1d",
                "op": "==",
                "value": "down",
                "ma_fast": 20,
                "ma_slow": 50
              }
            },
            "action": {
              "mode": "close",
              "confirm": "none"
            }
          }
        }
      ],
      "updated_at": "2025-12-02T17:58:21Z"
    }
  ]
}