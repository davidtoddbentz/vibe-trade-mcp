{
  "schemas": [
    {
      "type_id": "gate.regime",
      "schema_version": 1,
      "etag": "W/\"v1.gate.regime\"",
      "title": "Regime Gate",
      "summary": "Allow or block downstream cards when regime metrics align (trend, volatility, or custom factors).",
      "kind": "gate",
      "tags": [
        "regime",
        "trend",
        "volatility"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./gate.regime.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "regime": {
                "$ref": "common_defs.schema.json#/$defs/RegimeSpec"
              }
            },
            "required": [
              "regime"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/GateActionSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 150,
        "pit_safe": true,
        "warmup_hint": "Use the same history window as your regime metric."
      },
      "slot_hints": {
        "notes": "Set action.target_roles to the cards this gate guards (e.g., entries)."
      },
      "examples": [
        {
          "human": "Allow breakout entries only when EMA20 > EMA50 on BTC 1h.",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "BTC-USD"
            },
            "event": {
              "regime": {
                "metric": "trend_ma_relation",
                "tf": "1h",
                "op": ">",
                "value": 0.0,
                "lookback_bars": 200,
                "ma_fast": 20,
                "ma_slow": 50,
                "notes": "Positive spread implies fast MA above slow MA."
              }
            },
            "action": {
              "mode": "allow",
              "target_roles": [
                "entry"
              ],
              "target_ids": [
                "entry.breakout_trendfollow"
              ]
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    },
    {
      "type_id": "gate.event_risk_window",
      "schema_version": 1,
      "etag": "W/\"v1.gate.event_risk_window\"",
      "title": "Event Risk Window Gate",
      "summary": "Block or allow cards within a pre/post window around catalysts or macro events. Can also restrict to specific days of the week (e.g., Sunday-only, block Saturday/Monday).",
      "kind": "gate",
      "tags": [
        "event",
        "risk",
        "session"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./gate.event_risk_window.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "catalyst": {
                "$ref": "common_defs.schema.json#/$defs/EventSpec"
              },
              "pre_event_bars": {
                "type": "integer",
                "minimum": 0,
                "maximum": 5000
              },
              "post_event_bars": {
                "type": "integer",
                "minimum": 0,
                "maximum": 5000
              },
              "days_of_week": {
                "type": "array",
                "description": "Optional list of days of week this gate applies to (e.g., ['Sun', 'Mon']).",
                "items": {
                  "type": "string",
                  "enum": [
                    "Mon",
                    "Tue",
                    "Wed",
                    "Thu",
                    "Fri",
                    "Sat",
                    "Sun"
                  ]
                },
                "minItems": 1,
                "uniqueItems": true
              }
            },
            "required": [
              "catalyst",
              "pre_event_bars",
              "post_event_bars"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/GateActionSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 20,
        "pit_safe": true,
        "warmup_hint": "Event calendar ingestion must be point-in-time safe."
      },
      "slot_hints": {
        "notes": "Use pre/post_event_bars to define blackout windows relative to event start. Use days_of_week to restrict gate to specific days (e.g., ['Sun'] for Sunday-only, ['Mon'] for Monday-only)."
      },
      "examples": [
        {
          "human": "Block mean-reversion entries 8 bars before and 12 bars after AAPL earnings.",
          "slots": {
            "context": {
              "tf": "15m",
              "symbol": "AAPL"
            },
            "event": {
              "catalyst": {
                "event_kind": "earnings",
                "entry_window_bars": 3,
                "strength_filter": "strong"
              },
              "pre_event_bars": 8,
              "post_event_bars": 12
            },
            "action": {
              "mode": "block",
              "target_roles": [
                "entry",
                "overlay"
              ],
              "target_tags": [
                "mean-revert"
              ]
            }
          }
        },
        {
          "human": "Allow entries only on Sunday for BTC. Block entries on all other days.",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "BTC-USD"
            },
            "event": {
              "catalyst": {
                "event_kind": "session",
                "entry_window_bars": 1,
                "strength_filter": "any"
              },
              "pre_event_bars": 0,
              "post_event_bars": 0,
              "days_of_week": [
                "Sun"
              ]
            },
            "action": {
              "mode": "allow",
              "target_roles": [
                "entry"
              ]
            }
          }
        },
        {
          "human": "Block entries on Saturday and Monday morning for ETH. Allow entries on other days.",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "ETH-USD"
            },
            "event": {
              "catalyst": {
                "event_kind": "session",
                "entry_window_bars": 1,
                "strength_filter": "any"
              },
              "pre_event_bars": 0,
              "post_event_bars": 0,
              "days_of_week": [
                "Sat",
                "Mon"
              ]
            },
            "action": {
              "mode": "block",
              "target_roles": [
                "entry"
              ]
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    }
  ]
}

