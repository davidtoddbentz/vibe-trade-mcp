{
  "schemas": [
    {
      "type_id": "gate.regime",
      "schema_version": 1,
      "etag": "W/\"v1.gate.regime\"",
      "title": "Regime Gate",
      "summary": "Allow or block downstream cards when regime metrics align (trend, volatility, or custom factors).",
      "kind": "gate",
      "tags": [
        "regime",
        "trend",
        "volatility"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./gate.regime.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "regime": {
                "$ref": "common_defs.schema.json#/$defs/RegimeSpec"
              }
            },
            "required": [
              "regime"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/GateActionSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 150,
        "pit_safe": true,
        "warmup_hint": "Use the same history window as your regime metric."
      },
      "slot_hints": {
        "notes": "Set action.target_roles to the cards this gate guards (e.g., entries)."
      },
      "examples": [
        {
          "human": "Allow breakout entries only when EMA20 > EMA50 on BTC 1h.",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "BTC-USD"
            },
            "event": {
              "regime": {
                "metric": "trend_ma_relation",
                "tf": "1h",
                "op": ">",
                "value": 0.0,
                "lookback_bars": 200,
                "ma_fast": 20,
                "ma_slow": 50,
                "notes": "Positive spread implies fast MA above slow MA."
              }
            },
            "action": {
              "mode": "allow",
              "target_roles": [
                "entry"
              ],
              "target_ids": [
                "entry.breakout_trendfollow"
              ]
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    },
    {
      "type_id": "gate.event_risk_window",
      "schema_version": 1,
      "etag": "W/\"v1.gate.event_risk_window\"",
      "title": "Event Risk Window Gate",
      "summary": "Block or allow cards within a pre/post window around catalysts or macro events.",
      "kind": "gate",
      "tags": [
        "event",
        "risk",
        "session"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./gate.event_risk_window.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "catalyst": {
                "$ref": "common_defs.schema.json#/$defs/EventSpec"
              },
              "pre_event_bars": {
                "type": "integer",
                "minimum": 0,
                "maximum": 5000
              },
              "post_event_bars": {
                "type": "integer",
                "minimum": 0,
                "maximum": 5000
              }
            },
            "required": [
              "catalyst",
              "pre_event_bars",
              "post_event_bars"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/GateActionSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 20,
        "pit_safe": true,
        "warmup_hint": "Event calendar ingestion must be point-in-time safe."
      },
      "slot_hints": {
        "notes": "Use pre/post_event_bars to define blackout windows relative to event start."
      },
      "examples": [
        {
          "human": "Block mean-reversion entries 8 bars before and 12 bars after AAPL earnings.",
          "slots": {
            "context": {
              "tf": "15m",
              "symbol": "AAPL"
            },
            "event": {
              "catalyst": {
                "event_kind": "earnings",
                "entry_window_bars": 3,
                "strength_filter": "strong"
              },
              "pre_event_bars": 8,
              "post_event_bars": 12
            },
            "action": {
              "mode": "block",
              "target_roles": [
                "entry",
                "overlay"
              ],
              "target_tags": [
                "mean-revert"
              ]
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    },
    {
      "type_id": "gate.time_filter",
      "schema_version": 1,
      "etag": "W/\"v1.gate.time_filter\"",
      "title": "Time Filter Gate",
      "summary": "Allow or block downstream cards based on time filters (day of week, hours, date of month).",
      "kind": "gate",
      "tags": [
        "time",
        "session",
        "schedule"
      ],
      "json_schema": {
        "$schema": "https://json-schema.org/draft/2020-12/schema",
        "$id": "./gate.time_filter.schema.json",
        "type": "object",
        "properties": {
          "context": {
            "$ref": "common_defs.schema.json#/$defs/ContextSpec"
          },
          "event": {
            "type": "object",
            "properties": {
              "time_filter": {
                "$ref": "common_defs.schema.json#/$defs/TimeFilterSpec"
              }
            },
            "required": [
              "time_filter"
            ],
            "additionalProperties": false
          },
          "action": {
            "$ref": "common_defs.schema.json#/$defs/GateActionSpec"
          }
        },
        "required": [
          "context",
          "event",
          "action"
        ],
        "additionalProperties": false
      },
      "constraints": {
        "min_history_bars": 0,
        "pit_safe": true,
        "warmup_hint": "Time filters are evaluated in real-time based on current timestamp."
      },
      "slot_hints": {
        "notes": "Set action.target_roles to the cards this gate guards. At least one of days_of_week, time_window, or days_of_month must be specified in time_filter."
      },
      "examples": [
        {
          "human": "Allow entries only on weekdays (Monday-Friday) between 9:30 AM and 4:00 PM Eastern time.",
          "slots": {
            "context": {
              "tf": "15m",
              "symbol": "SPY"
            },
            "event": {
              "time_filter": {
                "days_of_week": [
                  "monday",
                  "tuesday",
                  "wednesday",
                  "thursday",
                  "friday"
                ],
                "time_window": "0930-1600",
                "timezone": "America/New_York"
              }
            },
            "action": {
              "mode": "allow",
              "target_roles": [
                "entry"
              ]
            }
          }
        },
        {
          "human": "Block all trading on the first and last day of each month.",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "BTC-USD"
            },
            "event": {
              "time_filter": {
                "days_of_month": [
                  1,
                  31
                ]
              }
            },
            "action": {
              "mode": "block",
              "target_roles": [
                "entry",
                "exit"
              ]
            }
          }
        },
        {
          "human": "Allow entries only on Tuesdays and Thursdays during market hours.",
          "slots": {
            "context": {
              "tf": "1h",
              "symbol": "AAPL"
            },
            "event": {
              "time_filter": {
                "days_of_week": [
                  "tuesday",
                  "thursday"
                ],
                "time_window": "0930-1600",
                "timezone": "America/New_York"
              }
            },
            "action": {
              "mode": "allow",
              "target_roles": [
                "entry"
              ]
            }
          }
        }
      ],
      "updated_at": "2025-12-04T00:00:00Z"
    }
  ]
}

